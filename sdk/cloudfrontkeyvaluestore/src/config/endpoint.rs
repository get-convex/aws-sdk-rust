// Code generated by software.amazon.smithy.rust.codegen.smithy-rs. DO NOT EDIT.
pub use ::aws_smithy_runtime_api::client::endpoint::EndpointFuture;
pub use ::aws_smithy_runtime_api::client::endpoint::SharedEndpointResolver;
pub use ::aws_smithy_types::endpoint::Endpoint;

///
#[cfg(test)]
mod test {

    /// FIPS should error
    #[test]
    fn test_1() {
        let params = crate::config::endpoint::Params::builder().use_fips(true).build().expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let error =
            endpoint.expect_err("expected error: Invalid Configuration: FIPS is not supported with CloudFront-KeyValueStore. [FIPS should error]");
        assert_eq!(
            format!("{}", error),
            "Invalid Configuration: FIPS is not supported with CloudFront-KeyValueStore."
        )
    }

    /// KVS ARN must be provided to use this service
    #[test]
    fn test_2() {
        let params = crate::config::endpoint::Params::builder().build().expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let error =
            endpoint.expect_err("expected error: KVS ARN must be provided to use this service [KVS ARN must be provided to use this service]");
        assert_eq!(format!("{}", error), "KVS ARN must be provided to use this service")
    }

    /// KVS ARN must be a valid ARN
    #[test]
    fn test_3() {
        let params = crate::config::endpoint::Params::builder()
            .kvs_arn("not-a-valid-arn".to_string())
            .build()
            .expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let error = endpoint.expect_err("expected error: KVS ARN must be a valid ARN [KVS ARN must be a valid ARN]");
        assert_eq!(format!("{}", error), "KVS ARN must be a valid ARN")
    }

    /// Provided ARN was not a valid CloudFront Service ARN. Found: `notcloudfront`
    #[test]
    fn test_4() {
        let params = crate::config::endpoint::Params::builder()
            .kvs_arn("arn:aws:notcloudfront::123456789012:key-value-store/my-first-kvs-e10b1dce4f394248811e77167e0451ba".to_string())
            .build()
            .expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let error = endpoint.expect_err("expected error: Provided ARN is not a valid CloudFront Service ARN. Found: `notcloudfront` [Provided ARN was not a valid CloudFront Service ARN. Found: `notcloudfront`]");
        assert_eq!(
            format!("{}", error),
            "Provided ARN is not a valid CloudFront Service ARN. Found: `notcloudfront`"
        )
    }

    /// Provided ARN must be a global resource ARN. Found: `us-west-2`
    #[test]
    fn test_5() {
        let params = crate::config::endpoint::Params::builder()
            .kvs_arn("arn:aws:cloudfront:us-west-2:123456789012:key-value-store/my-first-kvs-e10b1dce4f394248811e77167e0451ba".to_string())
            .build()
            .expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let error = endpoint.expect_err("expected error: Provided ARN must be a global resource ARN. Found: `us-west-2` [Provided ARN must be a global resource ARN. Found: `us-west-2`]");
        assert_eq!(format!("{}", error), "Provided ARN must be a global resource ARN. Found: `us-west-2`")
    }

    /// ARN resource type is invalid. Expected `key-value-store`, found: `some-other-resource-type`
    #[test]
    fn test_6() {
        let params = crate::config::endpoint::Params::builder()
            .kvs_arn("arn:aws:cloudfront::123456789012:some-other-resource-type/my-first-kvs-e10b1dce4f394248811e77167e0451ba".to_string())
            .build()
            .expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let error = endpoint.expect_err("expected error: ARN resource type is invalid. Expected `key-value-store`, found: `some-other-resource-type` [ARN resource type is invalid. Expected `key-value-store`, found: `some-other-resource-type`]");
        assert_eq!(
            format!("{}", error),
            "ARN resource type is invalid. Expected `key-value-store`, found: `some-other-resource-type`"
        )
    }

    /// CloudFront-KeyValueStore is not supported in partition `aws-cn`
    #[test]
    fn test_7() {
        let params = crate::config::endpoint::Params::builder()
            .kvs_arn("arn:aws-cn:cloudfront::123456789012:key-value-store/my-first-kvs-e10b1dce4f394248811e77167e0451ba".to_string())
            .build()
            .expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let error = endpoint.expect_err("expected error: CloudFront-KeyValueStore is not supported in partition `aws-cn` [CloudFront-KeyValueStore is not supported in partition `aws-cn`]");
        assert_eq!(format!("{}", error), "CloudFront-KeyValueStore is not supported in partition `aws-cn`")
    }

    /// CloudFront-KeyValueStore is not supported in partition `aws-us-gov`
    #[test]
    fn test_8() {
        let params = crate::config::endpoint::Params::builder()
            .kvs_arn("arn:aws-us-gov:cloudfront::123456789012:key-value-store/my-first-kvs-e10b1dce4f394248811e77167e0451ba".to_string())
            .build()
            .expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let error = endpoint.expect_err("expected error: CloudFront-KeyValueStore is not supported in partition `aws-us-gov` [CloudFront-KeyValueStore is not supported in partition `aws-us-gov`]");
        assert_eq!(
            format!("{}", error),
            "CloudFront-KeyValueStore is not supported in partition `aws-us-gov`"
        )
    }

    /// Valid account based endpoint
    #[test]
    fn test_9() {
        let params = crate::config::endpoint::Params::builder()
            .kvs_arn("arn:aws:cloudfront::123456789012:key-value-store/my-first-kvs-e10b1dce4f394248811e77167e0451ba".to_string())
            .build()
            .expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let endpoint = endpoint.expect("Expected valid endpoint: https://123456789012.cloudfront-kvs.global.api.aws");
        assert_eq!(
            endpoint,
            ::aws_smithy_types::endpoint::Endpoint::builder()
                .url("https://123456789012.cloudfront-kvs.global.api.aws")
                .property(
                    "authSchemes",
                    vec![::aws_smithy_types::Document::from({
                        let mut out = ::std::collections::HashMap::<String, ::aws_smithy_types::Document>::new();
                        out.insert("signingName".to_string(), "cloudfront-keyvaluestore".to_string().into());
                        out.insert("name".to_string(), "sigv4a".to_string().into());
                        out.insert(
                            "signingRegionSet".to_string(),
                            vec![::aws_smithy_types::Document::from("*".to_string())].into(),
                        );
                        out
                    })]
                )
                .build()
        );
    }

    /// Valid account based endpoint, with SDK region
    #[test]
    fn test_10() {
        let params = crate::config::endpoint::Params::builder()
            .kvs_arn("arn:aws:cloudfront::123456789012:key-value-store/my-first-kvs-e10b1dce4f394248811e77167e0451ba".to_string())
            .region("us-west-2".to_string())
            .build()
            .expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let endpoint = endpoint.expect("Expected valid endpoint: https://123456789012.cloudfront-kvs.global.api.aws");
        assert_eq!(
            endpoint,
            ::aws_smithy_types::endpoint::Endpoint::builder()
                .url("https://123456789012.cloudfront-kvs.global.api.aws")
                .property(
                    "authSchemes",
                    vec![::aws_smithy_types::Document::from({
                        let mut out = ::std::collections::HashMap::<String, ::aws_smithy_types::Document>::new();
                        out.insert("signingName".to_string(), "cloudfront-keyvaluestore".to_string().into());
                        out.insert("name".to_string(), "sigv4a".to_string().into());
                        out.insert(
                            "signingRegionSet".to_string(),
                            vec![::aws_smithy_types::Document::from("*".to_string())].into(),
                        );
                        out
                    })]
                )
                .build()
        );
    }

    /// Valid ARN, different partition, should error
    #[test]
    fn test_11() {
        let params = crate::config::endpoint::Params::builder()
            .kvs_arn("arn:aws:cloudfront::123456789012:key-value-store/my-first-kvs-e10b1dce4f394248811e77167e0451ba".to_string())
            .region("cn-north-1".to_string())
            .build()
            .expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let error = endpoint.expect_err(
            "expected error: Client was configured for partition `aws-cn` but Kvs ARN has `aws` [Valid ARN, different partition, should error]",
        );
        assert_eq!(format!("{}", error), "Client was configured for partition `aws-cn` but Kvs ARN has `aws`")
    }

    /// Valid account based endpoint with FIPS, should error
    #[test]
    fn test_12() {
        let params = crate::config::endpoint::Params::builder()
            .kvs_arn("arn:aws:cloudfront::123456789012:key-value-store/my-first-kvs-e10b1dce4f394248811e77167e0451ba".to_string())
            .region("us-east-1".to_string())
            .use_fips(true)
            .build()
            .expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let error = endpoint.expect_err("expected error: Invalid Configuration: FIPS is not supported with CloudFront-KeyValueStore. [Valid account based endpoint with FIPS, should error]");
        assert_eq!(
            format!("{}", error),
            "Invalid Configuration: FIPS is not supported with CloudFront-KeyValueStore."
        )
    }

    /// Custom sdk endpoint override
    #[test]
    fn test_13() {
        let params = crate::config::endpoint::Params::builder()
            .kvs_arn("arn:aws:cloudfront::123456789012:key-value-store/my-first-kvs-e10b1dce4f394248811e77167e0451ba".to_string())
            .region("us-east-1".to_string())
            .endpoint("https://my-override.example.com".to_string())
            .build()
            .expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let endpoint = endpoint.expect("Expected valid endpoint: https://123456789012.my-override.example.com");
        assert_eq!(
            endpoint,
            ::aws_smithy_types::endpoint::Endpoint::builder()
                .url("https://123456789012.my-override.example.com")
                .property(
                    "authSchemes",
                    vec![::aws_smithy_types::Document::from({
                        let mut out = ::std::collections::HashMap::<String, ::aws_smithy_types::Document>::new();
                        out.insert("signingName".to_string(), "cloudfront-keyvaluestore".to_string().into());
                        out.insert("name".to_string(), "sigv4a".to_string().into());
                        out.insert(
                            "signingRegionSet".to_string(),
                            vec![::aws_smithy_types::Document::from("*".to_string())].into(),
                        );
                        out
                    })]
                )
                .build()
        );
    }

    /// Custom sdk endpoint override with path and http
    #[test]
    fn test_14() {
        let params = crate::config::endpoint::Params::builder()
            .kvs_arn("arn:aws:cloudfront::123456789012:key-value-store/my-first-kvs-e10b1dce4f394248811e77167e0451ba".to_string())
            .endpoint("http://my-override.example.com/custom-path".to_string())
            .build()
            .expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let endpoint = endpoint.expect("Expected valid endpoint: http://123456789012.my-override.example.com/custom-path");
        assert_eq!(
            endpoint,
            ::aws_smithy_types::endpoint::Endpoint::builder()
                .url("http://123456789012.my-override.example.com/custom-path")
                .property(
                    "authSchemes",
                    vec![::aws_smithy_types::Document::from({
                        let mut out = ::std::collections::HashMap::<String, ::aws_smithy_types::Document>::new();
                        out.insert("signingName".to_string(), "cloudfront-keyvaluestore".to_string().into());
                        out.insert("name".to_string(), "sigv4a".to_string().into());
                        out.insert(
                            "signingRegionSet".to_string(),
                            vec![::aws_smithy_types::Document::from("*".to_string())].into(),
                        );
                        out
                    })]
                )
                .build()
        );
    }

    /// Custom override with different partition should error
    #[test]
    fn test_15() {
        let params = crate::config::endpoint::Params::builder()
            .kvs_arn("arn:aws:cloudfront::123456789012:key-value-store/my-first-kvs-e10b1dce4f394248811e77167e0451ba".to_string())
            .region("us-gov-east-1".to_string())
            .endpoint("https://my-override.example.com".to_string())
            .build()
            .expect("invalid params");
        let resolver = crate::config::endpoint::DefaultResolver::new();
        let endpoint = resolver.resolve_endpoint(&params);
        let error = endpoint.expect_err("expected error: Client was configured for partition `aws-us-gov` but Kvs ARN has `aws` [Custom override with different partition should error]");
        assert_eq!(
            format!("{}", error),
            "Client was configured for partition `aws-us-gov` but Kvs ARN has `aws`"
        )
    }
}

/// Endpoint resolver trait specific to Amazon CloudFront KeyValueStore
pub trait ResolveEndpoint: ::std::marker::Send + ::std::marker::Sync + ::std::fmt::Debug {
    /// Resolve an endpoint with the given parameters
    fn resolve_endpoint<'a>(&'a self, params: &'a crate::config::endpoint::Params) -> ::aws_smithy_runtime_api::client::endpoint::EndpointFuture<'a>;

    /// Convert this service-specific resolver into a `SharedEndpointResolver`
    ///
    /// The resulting resolver will downcast `EndpointResolverParams` into `crate::config::endpoint::Params`.
    fn into_shared_resolver(self) -> ::aws_smithy_runtime_api::client::endpoint::SharedEndpointResolver
    where
        Self: Sized + 'static,
    {
        ::aws_smithy_runtime_api::client::endpoint::SharedEndpointResolver::new(DowncastParams(self))
    }
}

#[derive(Debug)]
struct DowncastParams<T>(T);
impl<T> ::aws_smithy_runtime_api::client::endpoint::ResolveEndpoint for DowncastParams<T>
where
    T: ResolveEndpoint,
{
    fn resolve_endpoint<'a>(
        &'a self,
        params: &'a ::aws_smithy_runtime_api::client::endpoint::EndpointResolverParams,
    ) -> ::aws_smithy_runtime_api::client::endpoint::EndpointFuture<'a> {
        let ep = match params.get::<crate::config::endpoint::Params>() {
            Some(params) => self.0.resolve_endpoint(params),
            None => ::aws_smithy_runtime_api::client::endpoint::EndpointFuture::ready(Err("params of expected type was not present".into())),
        };
        ep
    }
}

/// The default endpoint resolver
#[derive(Debug, Default)]
pub struct DefaultResolver {
    partition_resolver: crate::endpoint_lib::partition::PartitionResolver,
}

impl DefaultResolver {
    /// Create a new endpoint resolver with default settings
    pub fn new() -> Self {
        Self {
            partition_resolver: crate::endpoint_lib::DEFAULT_PARTITION_RESOLVER.clone(),
        }
    }

    fn resolve_endpoint(
        &self,
        params: &crate::config::endpoint::Params,
    ) -> Result<::aws_smithy_types::endpoint::Endpoint, ::aws_smithy_runtime_api::box_error::BoxError> {
        let mut diagnostic_collector = crate::endpoint_lib::diagnostic::DiagnosticCollector::new();
        Ok(
            crate::config::endpoint::internals::resolve_endpoint(params, &mut diagnostic_collector, &self.partition_resolver)
                .map_err(|err| err.with_source(diagnostic_collector.take_last_error()))?,
        )
    }
}

impl crate::config::endpoint::ResolveEndpoint for DefaultResolver {
    fn resolve_endpoint(&self, params: &crate::config::endpoint::Params) -> ::aws_smithy_runtime_api::client::endpoint::EndpointFuture {
        ::aws_smithy_runtime_api::client::endpoint::EndpointFuture::ready(self.resolve_endpoint(params))
    }
}

#[non_exhaustive]
#[derive(::std::clone::Clone, ::std::cmp::PartialEq, ::std::fmt::Debug)]
/// Configuration parameters for resolving the correct endpoint
pub struct Params {
    /// The ARN of the Key Value Store
    pub(crate) kvs_arn: ::std::option::Option<::std::string::String>,
    /// The AWS region used to dispatch the request.
    pub(crate) region: ::std::option::Option<::std::string::String>,
    /// When true, send this request to the FIPS-compliant regional endpoint. If the configured endpoint does not have a FIPS compliant endpoint, dispatching the request will return an error.
    pub(crate) use_fips: bool,
    /// Override the endpoint used to send this request
    pub(crate) endpoint: ::std::option::Option<::std::string::String>,
}
impl Params {
    /// Create a builder for [`Params`]
    pub fn builder() -> crate::config::endpoint::ParamsBuilder {
        crate::config::endpoint::ParamsBuilder::default()
    }
    /// The ARN of the Key Value Store
    pub fn kvs_arn(&self) -> ::std::option::Option<&str> {
        self.kvs_arn.as_deref()
    }
    /// The AWS region used to dispatch the request.
    pub fn region(&self) -> ::std::option::Option<&str> {
        self.region.as_deref()
    }
    /// When true, send this request to the FIPS-compliant regional endpoint. If the configured endpoint does not have a FIPS compliant endpoint, dispatching the request will return an error.
    pub fn use_fips(&self) -> ::std::option::Option<bool> {
        Some(self.use_fips)
    }
    /// Override the endpoint used to send this request
    pub fn endpoint(&self) -> ::std::option::Option<&str> {
        self.endpoint.as_deref()
    }
}

/// Builder for [`Params`]
#[derive(::std::clone::Clone, ::std::cmp::PartialEq, ::std::default::Default, ::std::fmt::Debug)]
pub struct ParamsBuilder {
    kvs_arn: ::std::option::Option<::std::string::String>,
    region: ::std::option::Option<::std::string::String>,
    use_fips: ::std::option::Option<bool>,
    endpoint: ::std::option::Option<::std::string::String>,
}
impl ParamsBuilder {
    /// Consume this builder, creating [`Params`].
    pub fn build(self) -> ::std::result::Result<crate::config::endpoint::Params, crate::config::endpoint::InvalidParams> {
        Ok(
            #[allow(clippy::unnecessary_lazy_evaluations)]
            crate::config::endpoint::Params {
                kvs_arn: self.kvs_arn,
                region: self.region,
                use_fips: self
                    .use_fips
                    .or_else(|| Some(false))
                    .ok_or_else(|| crate::config::endpoint::InvalidParams::missing("use_fips"))?,
                endpoint: self.endpoint,
            },
        )
    }
    /// Sets the value for kvs_arn
    ///
    /// The ARN of the Key Value Store
    pub fn kvs_arn(mut self, value: impl Into<::std::string::String>) -> Self {
        self.kvs_arn = Some(value.into());
        self
    }

    /// Sets the value for kvs_arn
    ///
    /// The ARN of the Key Value Store
    pub fn set_kvs_arn(mut self, param: Option<::std::string::String>) -> Self {
        self.kvs_arn = param;
        self
    }
    /// Sets the value for region
    ///
    /// The AWS region used to dispatch the request.
    pub fn region(mut self, value: impl Into<::std::string::String>) -> Self {
        self.region = Some(value.into());
        self
    }

    /// Sets the value for region
    ///
    /// The AWS region used to dispatch the request.
    pub fn set_region(mut self, param: Option<::std::string::String>) -> Self {
        self.region = param;
        self
    }
    /// Sets the value for use_fips
    ///
    /// When unset, this parameter has a default value of `false`.
    /// When true, send this request to the FIPS-compliant regional endpoint. If the configured endpoint does not have a FIPS compliant endpoint, dispatching the request will return an error.
    pub fn use_fips(mut self, value: impl Into<bool>) -> Self {
        self.use_fips = Some(value.into());
        self
    }

    /// Sets the value for use_fips
    ///
    /// When unset, this parameter has a default value of `false`.
    /// When true, send this request to the FIPS-compliant regional endpoint. If the configured endpoint does not have a FIPS compliant endpoint, dispatching the request will return an error.
    pub fn set_use_fips(mut self, param: Option<bool>) -> Self {
        self.use_fips = param;
        self
    }
    /// Sets the value for endpoint
    ///
    /// Override the endpoint used to send this request
    pub fn endpoint(mut self, value: impl Into<::std::string::String>) -> Self {
        self.endpoint = Some(value.into());
        self
    }

    /// Sets the value for endpoint
    ///
    /// Override the endpoint used to send this request
    pub fn set_endpoint(mut self, param: Option<::std::string::String>) -> Self {
        self.endpoint = param;
        self
    }
}

/// An error that occurred during endpoint resolution
#[derive(Debug)]
pub struct InvalidParams {
    field: std::borrow::Cow<'static, str>,
}

impl InvalidParams {
    #[allow(dead_code)]
    fn missing(field: &'static str) -> Self {
        Self { field: field.into() }
    }
}

impl std::fmt::Display for InvalidParams {
    fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {
        write!(f, "a required field was missing: `{}`", self.field)
    }
}

impl std::error::Error for InvalidParams {}

mod internals;
